


<div class="row" ng-controller="estimateController" ng-init="initializeController()">
    <div class="row" ng-hide="newEdit===true||details===true">
        <br />
        <div class="row">
            <div class="col-md-9">
                <h4>Proforma Invoices</h4>
            </div>
            <div class="3">
                <a ng-click="newEstimate()" class="btnAdd btn" style="width: 175px; float: right; text-align:right">New Proforma Invoice</a>
            </div>
        </div>
        <br />
        <table ng-estimates>
            <thead>
                <tr style="color: #fff">
                    <th style="width: 3%; text-align: left">
                        S/N
                    </th>
                    <th style="width: 12%; text-align: left">
                        Ref. No
                    </th>
                    <th style="width: 15%; text-align: left">
                        Customer
                    </th>
                    <th style="width: 12%; text-align: left">
                        Date Created
                    </th>
                    <th style="width: 13%; text-align: left">
                        Amount Due({{store.DefaultCurrencySymbol}})
                    </th>
                    <th style="width: 12%; text-align: left">
                        Net Amount({{store.DefaultCurrencySymbol}})
                    </th>
                    <th style="width: 18%; text-align: left">
                        Generated By
                    </th>
                    <th style="width: 10%; text-align: left">
                        Status
                    </th>
                    <th style="width: 6%">
                        Action
                    </th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

<fieldset style="border: none; background: whitesmoke" ng-show="newEdit===true">

<div class="row" style="border-bottom: 1px solid #e0e0e0">
    <div class="col-md-3">
        <br/>
        <h4>{{estimate.Header}}</h4>
        <br/>
    </div>
    <div class="col-md-6  divlesspadding">
        <br />
        <div class="row">
            <div class="col-md-12 divlesspadding">
                <h5 style="padding-left: 0px;">Customer : <b>{{estimate.CustomerObject.UserProfileName}} </b></h5>
            </div>
        </div>
        <br />
    </div>
    <div class="col-md-2">
        <br/>
        <input type="button" value="Print" ng-click="preparePrint()" ng-show="estimate.Id > 0" class="btn btn-primary" style="float: left"/>
    </div>
    <div class="col-md-1">
        <br/>
        <input type="button" value="<< Back" ng-click="goBack()" class="btn btn-default" style="float: right"/>
    </div>
</div>

<div class="row alert alert-success" role="alert" ng-show="positivefeedback == true">
    <span class="col-md-11">{{success}}</span><span class="col-md-1" style="font-size: 20px; text-align: left; cursor: pointer" title="close" ng-click="positivefeedback = false">x</span>
</div>
<div class="row alert alert-danger" role="alert" ng-show="negativefeedback == true">
    <span class="col-md-11">{{error}}</span><span class="col-md-1" style="font-size: 20px; text-align: left; cursor: pointer" title="close" ng-click="negativefeedback = false">x</span>
</div>

<div class="row fsEdit" style="width: 100%;">
<!--border: 3px solid #27ae60;-->
<div class="modal-body">
<form method="POST">
<div class="row">
<div class="col-md-8 right-border">
    <div class="row">
        <div class="col-md-8" style="padding-right: 7px; padding-left: 0px;">

            <!-- getProductsBySku() is triggered in /Scripts/anguComplete.js (line : 213). This should be made generic. could not implement due to time constraint -->
            <angucomplete id="stockControl"
                          placeholder="Search Product by Name or SKU"
                          pause="10"
                          selectedobject="selectedStock"
                          url="{{homeroot}}/Sales/SearchAllItemPriceListByOutlet?criteria="
                          searchfields="SKU,StoreItemName"
                          titlefield="StoreItemName"
                          minlength="1" inputclass="form-control font-size-1-1"
                          callback="getProductsBySku" clearselection="true" />
        </div>
        <div class="col-md-4">
            <input ng-if="isCashier === true" type="button" value="Process Invoice" ng-click="prepareInvoice()" class="btn btn-default" style="float: right" ng-show="estimate.Id > 0"/>
        </div>
    </div>
    <div class="row" style="margin-top: 8px">
        <table class="table-responsive table" role="grid" style="float: left">
            <thead>
            <tr style="text-align: left; background-color: whitesmoke;">
                <th style="color: #008000;">
                    Item
                </th>
                <th style="color: #008000;">
                    Quantity
                </th>
                <th style="color: #008000;">
                    Rate({{store.DefaultCurrencySymbol}})
                </th>
                <th style="color: #008000;">
                    Total({{store.DefaultCurrencySymbol}})
                </th>
                <th style="width: 5%; color: #008000;">
                    Action
                </th>
            </tr>
            </thead>
            <tbody>
            <tr data-ng-repeat="estimateItem in estimate.EstimateItemObjects">
                <td>
                    <div class="row">
                        <div class="col-md-4" style="padding-right: 10px">
                            <img src="{{estimateItem.ImagePath}}" style="width: 70%"/>
                        </div>
                        <div class="col-md-8" style="padding: 0px">
                            <div class="row" style="padding: 0px">
                                <label style="font-weight: normal">{{estimateItem.StoreItemName}}</label>
                            </div>
                            <div class="row" style="padding: 0px">
                                <div class="col-md-4" style="padding: 0px">
                                    <label class="control-label " style="font-weight: normal">SKU:</label>
                                </div>
                                <div class="col-md-8" style="padding: 0px">
                                    <label class="control-label " style="font-weight: normal">{{estimateItem.SerialNumber}}</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    <input type="text" ng-model="estimateItem.QuantityRequested" ng-change="updateAmount(estimateItem)" ng-blur="checkQuantity(estimateItem)" class="form-control" ui-number-mask="" />
                </td>
                <td>
                    <input type="text" ng-model="estimateItem.ItemPrice" ng-change="updateAmount(estimateItem)" ng-blur="checkQuantity(estimateItem)" class="form-control" ui-number-mask="" />
                </td>
                <td>
                    <label class="control-label " style="font-weight: normal">{{estimateItem.AmountSold | currency: " "}}</label>
                </td>
                <td>
                    <a title="Delete" style="cursor: pointer" ng-click="removeEstimateItem(estimateItem.TempId)"><img src="/Content/images/delete.png"/></a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

    
<div class="col-md-4 divlesspadding">
    <div class="row">
        <div class="col-md-6">
            <h5>Amount Due({{store.DefaultCurrencySymbol}}):</h5>
        </div>
        <div class="col-md-6" style="padding-right: 5px;">
            <h4 style="padding-left: 0px; text-align: right">{{estimate.AmountDue | currency: " "}} </h4>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-4 divlesspadding">
                    <h5>Discount(%):</h5>
                </div>
                <div class="col-md-8 divlesspadding" style="padding-left: 35px;">
                    <input type="text" ng-model="estimate.Discount" ng-change="updateAmountForDiscount(estimate.Discount)" class="form-control"/>
                </div>
            </div>
        </div>
        <div class="col-md-6" style="padding-right: 5px;">
            <h4 style="padding-left: 0px; text-align: right;">{{estimate.DiscountAmount | currency: " "}} </h4>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12 divlesspadding">
                    <label style="font-weight: normal">Apply {{store.VAT}}% VAT? &nbsp; <input type="checkbox" ng-model="estimate.applyVat" ng-click="applyVat()"/></label>
                </div>
                <!--<div class="col-md-8 divlesspadding" style="padding-left: 35px;">

                </div>-->
            </div>
        </div>
        <div class="col-md-6" style="padding-right: 5px;">
            <h4 style="padding-left: 0px; text-align: right;">{{estimate.VATAmount | currency: " "}} </h4>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <h5>Net Amount({{store.DefaultCurrencySymbol}}):</h5>
        </div>
        <div class="col-md-6" style="padding-right: 5px;">
            <h4 style="padding-left: 0px; text-align: right;">{{estimate.NetAmount | currency: " "}} </h4>
        </div>
    </div>
    <div class="row" ng-show="processInvoice === true" ng-cloak>
        <hr style="padding-bottom: 2px; padding-top: 2px; margin-bottom: 0px;"/>
        <div class="row">
            <div class="row">
                <div class="col-md-12">
                    <label class="control-label ">Payment Option *</label>
                    <ui-select ng-model="genericSale.Sale.paymentOption" theme="bootstrap" class="fullWdith" ng-change="setPaymentOption(genericSale.Sale.paymentOption)">
                        <ui-select-match placeholder="-- Select payment Option --">{{$select.selected.Name}}</ui-select-match>
                        <ui-select-choices repeat="method in paymentMethods | propsFilter: {Name: $select.search} track by method.StorePaymentMethodId">
                            <div ng-bind-html="method.Name | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>
                </div>
            </div>
            <hr style="padding-bottom: 2px; padding-top: 2px; margin-bottom: 0px;"/>
            <div class="row">
               
                <!--ng-show="splitOption == true || cash == true"-->

                <div class="col-md-6" style="padding-right: 0px;">
                    <p>
                        <input type="text" ng-change="updateamountpaid(cashAmount)" ng-model="cashAmount" class=" form-control" required style="font-weight: bold;" placeholder="Amount" ui-number-mask="" />
                    </p>
                </div>
                <!--<div class="col-md-6" style="padding-left: 9px;">
                <p ng-show="splitOption == true || pos == true">
                    <input type="text" ng-model="posAmount" ng-change="updateamountpaid(posAmount)" class=" form-control" required readonly="readonly" style="font-weight: bold" placeholder="POS Value" ui-number-mask=""/>
                </p>
            </div>-->


            </div>

            <div class="row">
                <div class="col-md-6">
                    <h5>Amount Paid({{store.DefaultCurrencySymbol}}):</h5>
                </div>
                <div class="col-md-6">
                    <h4 style="text-align: right">{{amountPaid | currency: " "}} </h4>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h5>Balance({{store.DefaultCurrencySymbol}}):</h5>
                </div>
                <div class="col-md-6">
                    <h4 style="text-align: right" ng-class="{'lkp': balance > 0}">{{balance | currency: " "}} </h4>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12" style="padding-right: 0px;">
            <label class="control-label ">New Customer &nbsp;&nbsp;<a style="cursor: pointer" ng-click="addNewCustomer()"><img src="/Content/images/plus-green.png" style="width: 16px; height: 16px" title="New Customer"/></a></label>

            <angucomplete id="customerControl"
                          placeholder="Search Customer by Name or phone number"
                          pause="200"
                          selectedobject="selectedCustomer"
                          url="{{homeroot}}/Customer/SearchCustomer?criteria="
                          datafield="results"
                          searchfields="UserProfileName"
                          titlefield="UserProfileName"
                          minlength="1" inputclass="form-control font-size-1-1"
                          callback="setCustomer" clearselection="false" />
            <!--<ui-select ng-model="customer" theme="bootstrap" class="fullWdith" ng-change="setCustomer(customer)">
                <ui-select-match placeholder="-- Select Customer --">{{$select.selected.UserProfileName}}</ui-select-match>
                <ui-select-choices repeat="cst in customers | propsFilter: {UserProfileName: $select.search} track by cst.CustomerId">
                    <div ng-bind-html="cst.UserProfileName | highlight: $select.search"></div>
                </ui-select-choices>
            </ui-select>-->
        </div>

    </div>
    <div class="row modal-footer">
        <div class="col-md-4" ng-hide="processInvoice === true">
            <input type="button" ng-show="estimate != null && estimate.EstimateItemObjects.length > 0" value="Submit" ng-disabled="processing === true" ng-click="processEstimate()" class="btn btn-primary" style="font-weight: bold" />
        </div>
        <div class="col-md-4" ng-show="processInvoice === true">
            <input type="button" value="Submit" ng-disabled="processing === true" ng-click="processSale()" class="btn btn-primary" style="font-weight: bold" />
        </div>
        <div class="col-md-7">

        </div>
    </div>
</div>
</div>
<br/>
<div class="row modal-footer">
</div>
</form>
</div>
</div>

</fieldset>
    <div class="row" ng-show="details === true">
        <br /><br />
        <div style="visibility: visible; border: 3px solid #008000" class="col-md-12">
            <div class="row">
                <div class="col-md-6">
                    <br/>
                    <h4>{{estimate.Header}}</h4>
                    <br/>
                </div>
                <div class="col-md-3">
                    <br/>
                    <input type="button" value="Print" ng-click="printReceipt3()" class="btn btn-primary" style="float: right" />
                </div>
                <div class="col-md-3">
                    <br/>
                    <input type="button" value="<< Back" ng-click="goBack()" class="btn btn-default" style="float: right"/>
                </div>
            </div>
            <br />
            <div class="row" id="invoiceInfo">

            </div>
        </div>
        <br /><br />
    </div>
    <br /><br /><br /><br /><br /><br /><br />
    <div class="row" id="receipt">

    </div>
<br /><br /><br />

</div>

